!function(a){"use strict";var b=function(a){var b=this;this.init(),a&&81===a.length&&a.forEach(function(a,c){var d=Math.floor(c/9),e=c%9;a&&b.addValue(a,d,e)})};b.prototype.init=function(){this.finished=!1,this.stuck=!1,this.lines=[[],[],[],[],[],[],[],[],[]],this.columns=[[],[],[],[],[],[],[],[],[]],this.blocks=[[],[],[],[],[],[],[],[],[]],this.grid=[],this.eventHandler={},this.eventHandler.finded=function(){};for(var a=0;81>a;a++){var b=Math.floor(a/9),c=a%9,d=3*Math.floor(b/3)+Math.floor(c/3),e={value:null,candidates:[1,2,3,4,5,6,7,8,9],revocated:[],line:b,column:c,block:d,index:a};this.lines[b].push(e),this.columns[c].push(e),this.blocks[d].push(e),this.grid[a]=e}return this},b.prototype.on=function(a,b){return a in this.eventHandler&&"function"==typeof b&&(this.eventHandler[a]=b),this},b.prototype.each=function(a){var b=this;return"function"==typeof a&&this.grid.forEach(function(c){a.call(b,{line:c.line,column:c.column})}),this},b.prototype.isFinished=function(){return this.finished},b.prototype.isStuck=function(){return this.stuck},b.prototype.getValue=function(a,b){return this.lines[a][b].value},b.prototype.getCandidates=function(a,b){return this.lines[a][b].candidates},b.prototype.addValue=function(a,b,c){var d=this.lines[b][c].block,e=!1;return this.grid.map(function(f){if(f.line===b&&f.column===c&&(f.value=a,f.candidates=[]),f.line===b||f.column===c||f.block===d){var g=f.candidates.indexOf(a);-1!=g&&f.candidates.splice(g,1),-1!=f.revocated.indexOf(a)&&f.revocated.push(a)}f.value||(e=!0)}),this.finished=!e,this},b.prototype.findLonelyCandidate=function(){var a=this,b=0;return this.grid.map(function(c){c.value||1!==c.candidates.length||(a.addValue(c.candidates[0],c.line,c.column),a.eventHandler.finded.call(a,c.candidates[0],{line:c.line,column:c.column},"findLonelyCandidate"),b++)}),b},b.prototype.findHiddenSingle=function(){var a=this,b=0;return this.grid.map(function(c){if(!c.value){var d;c.candidates.forEach(function(b){var e=a.lines[c.line].filter(function(a){return-1!=a.candidates.indexOf(b)}).length,f=a.columns[c.column].filter(function(a){return-1!=a.candidates.indexOf(b)}).length,g=a.blocks[c.block].filter(function(a){return-1!=a.candidates.indexOf(b)}).length;(1===e||1===f||1===g)&&(d=b)}),d&&(a.addValue(d,c.line,c.column),a.eventHandler.finded.call(a,d,{line:c.line,column:c.column},"findHiddenSingle"),b++)}}),b},b.prototype.resolve=function(){for(;!this.isFinished()&&!this.isStuck();)this.findLonelyCandidate()||this.findHiddenSingle()||(this.stuck=!0);return this},a.Sudoku=b}(window);