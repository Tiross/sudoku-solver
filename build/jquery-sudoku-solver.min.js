!function(a){"use strict";var b=function(a){var b=this;this.init(),a&&81===a.length&&a.forEach(function(a,c){var d=Math.floor(c/9),e=c%9;a&&b.addValue(a,d,e)})};b.prototype.init=function(){this.finished=!1,this.stuck=!1,this.lines=[[],[],[],[],[],[],[],[],[]],this.columns=[[],[],[],[],[],[],[],[],[]],this.blocks=[[],[],[],[],[],[],[],[],[]],this.grid=[],this.eventHandler={},this.eventHandler.finded=function(){},this.eventHandler.finished=function(){},this.eventHandler.stucked=function(){},this.eventHandler.candidates=function(){};for(var a=0;81>a;a++){var b=Math.floor(a/9),c=a%9,d=3*Math.floor(b/3)+Math.floor(c/3),e={value:null,candidates:[1,2,3,4,5,6,7,8,9],revocated:[],line:b,column:c,block:d,index:a};this.lines[b].push(e),this.columns[c].push(e),this.blocks[d].push(e),this.grid[a]=e}return this},b.prototype.on=function(a,b){return a in this.eventHandler&&"function"==typeof b&&(this.eventHandler[a]=b),this},b.prototype.each=function(a){var b=this;return"function"==typeof a&&this.grid.forEach(function(c){a.call(b,{line:c.line,column:c.column,block:c.block})}),this},b.prototype.isFinished=function(){return this.finished},b.prototype.markFinished=function(){return this.finished=!0,this.eventHandler.finished.call(this),this},b.prototype.isStuck=function(){return this.stuck},b.prototype.markStuck=function(){return this.stuck=!0,this.eventHandler.stucked.call(this),this},b.prototype.getValue=function(a,b){return this.lines[a][b].value},b.prototype.getCandidates=function(a,b){return this.lines[a][b].candidates},b.prototype.addValue=function(a,b,c){var d=this.lines[b][c].block,e=!1,f=this;return this.lines[b][c].value?this:(this.grid.map(function(g){if(g.line===b&&g.column===c&&(g.value=a,g.candidates=[],f.eventHandler.finded.call(f,a,{line:b,column:c,block:d})),g.line===b||g.column===c||g.block===d){var h=g.candidates.indexOf(a);-1!=h&&(g.candidates.splice(h,1),f.eventHandler.candidates.call(f,g.candidates,{line:b,column:c})),-1!=g.revocated.indexOf(a)&&g.revocated.push(a)}g.value||(e=!0)}),e||this.markFinished(),this)},b.prototype.findLonelyCandidate=function(){var a=this,b=0;return this.grid.map(function(c){c.value||1!==c.candidates.length||(a.addValue(c.candidates[0],c.line,c.column),b++)}),b},b.prototype.findHiddenSingle=function(){var a=this,b=0;return this.grid.map(function(c){if(!c.value){var d;c.candidates.forEach(function(b){var e=a.lines[c.line].filter(function(a){return-1!=a.candidates.indexOf(b)}).length,f=a.columns[c.column].filter(function(a){return-1!=a.candidates.indexOf(b)}).length,g=a.blocks[c.block].filter(function(a){return-1!=a.candidates.indexOf(b)}).length;(1===e||1===f||1===g)&&(d=b)}),d&&(a.addValue(d,c.line,c.column),b++)}}),b},b.prototype.next=function(){return this.isFinished()||this.findLonelyCandidate()||this.findHiddenSingle()||this.markStuck(),this},b.prototype.resolve=function(){for(;!this.isFinished()&&!this.isStuck();)this.next();return this},a.Sudoku=b}(window),function(a,b){"use strict";a.fn.sudoku=function(c,d){return this.each(function(){var e=a(this),f=e.data("sudoku");if(!f){e.data("sudoku",f=new b(e.data("grid")));var g=a(document.createElement("div")).addClass("cell"),h=a(document.createElement("div")).addClass("candidate"),i=a(document.createElement("input")).addClass("value").attr("type","text");f.each(function(b){for(var c=f.getValue(b.line,b.column),d=f.getCandidates(b.line,b.column),j=["line-"+b.line,"column-"+b.column,"block-"+b.block],k=g.clone().addClass(j.join(" ")).data(b).appendTo(e),l=1;9>=l;l++)h.clone().addClass("candidate-"+l).text(-1!=d.indexOf(l)?l:null).appendTo(k);i.clone().data(b).val(c).appendTo(k).on("change",function(b){var c=a(this);f.addValue(c.val(),c.data("line"),c.data("column"))})}).on("finded",function(b,c){e.trigger("value:finded",a.extend({},{value:b},c))}).on("candidates",function(b,c){e.trigger("candidates:change",a.extend({},{candidates:b},c))}).on("finished",function(){e.trigger("finished")}).on("stucked",function(){e.trigger("stucked")})}c&&c in f&&f[c](d)})}}(window.jQuery,window.Sudoku);